# TCP的基本概念

## 1.三次握手机制

首先发送端建立连接时会先发送一个同步信号给接收端，接收端接收到后会做一个确认应答，表示接收到了发送端的数据，当发送端接受到确认应答后，会给接收端再发送一个接到确认应答的应答。此时则三次握手建立，开始传输数据。如图所示

![三次握手](F:\GitHub\SmallBits\bit\SmallBits\三次握手.png)

## 2.四次挥手

当发送端数据发送完，会给接收端发送一个断开连接的信号，当接收端接受到后会发送一个确认断开应答，此时处于一个半关闭状态，表示发送端没有数据给接收端，但可能接受端还有数据需要发送，所以接收端并不会关闭，只有当接收端结束数据发送后才会给发送端发送一个释放连接信号，当发送端接收到释放信号后会给接收端一个应答确认，当接收端接受到后释放连接。如图所示：

![四次挥手](F:\GitHub\SmallBits\bit\SmallBits\四次挥手.png)



## 3.重发超时时间

在数据重新发送之前，等待确认应答的时间间隔叫做重发时间。TCP会根据每次发送包的往返时间加上偏差时间，将其相加，则重发时间则是比这个和稍微大一点的时间。

## 4.窗口控制

当数据发送时每次数据发送过去，当接收端接受到数据后会发送一个确认应答，当发送端接收到确认应答后才会发送下一个数据包。当网络不太好时则会很多时间浪费等待确认应答上。而窗口控制则是首先确认窗口大小，然后在这个范围内发送数据出去，不必等到收到确认应答，也接着继续发送数据。比如窗口大小为4，则发送数据1，不必等待数据1的确认应答，可以接着发送数据2 ，直到数据4发送。

此时就会有个问题，这么发送如果某个数据包未回复确认应答怎么办？未回复确认应答有两种情况

**1.接收端接收到数据，但确认应答丢失**

因为数据包发送时的序列号是连续的，比如数据1的编号是1-100，数据2的编号为101-200。。。而确认应答则是当受到数据1，应答则将其编号加一，表示收到该数据，下次数据的开始编号为此数。

比如数据1接收端收到，但是确认应答丢失，而接着数据2收到，数据2的确认应答并未丢失，此时发送端接受到数据2的确认应答，则知道此时并没有数据丢失。

**2.发送端数据丢失**

比如数据1正常，数据则确认应答的下一个编号为101，但是数据2丢失，则确认应答的下一个编号也是101，当相同的确认应答重复三次，则表示该数据丢失，则会重新发送该数据。

## 5.流控制

流量控制是为了解决当数据量很大，但是接收端的接收能力不足的问题。在TCP建立连接时，接收端会给发送端发送一个可以接受的数据量大小，这个就是窗口大小。而发送端发送的数据则一次不会超过这个数，当发送一个窗口大小的数据后就会停止，等待接收端处理后的更新消息，当接收端处理完数据后会更新状态，发送给发送端，然后又开始传输数据。





















