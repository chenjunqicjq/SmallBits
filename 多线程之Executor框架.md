# 多线程之Executor框架

Executor是一个可以快速处理任务，并且支持异步处理结果的框架。其主要组成包括几部分。

1.任务。实现了接口Runnable，Called接口的类或接口。

2.任务的执行。实现了Executor接口的类或接口。

3.异步处理结果。实现了Future或者类FutureTadk的接口。

## 任务

实现了Runnable或Called接口的类的对象，可以作为一个任务对象被执行。当然，事项Runnable接口的类的对象只是执行，不能知道是否执行完成，也不知道执行结果；二实现Caled接口的类的对象则可以返回一个异步对象，通过这个对象可以查看执行结果。

## 执行

执行任务主要由几个实现了Exector接口的线程池执行类执行。如FixedThreadPool,SingleThreadPool,CachedThreadPool等几个线程池。

**FixedThreadPool**:该线程池可以指定核心线程池的线程数量，此线程池使用于服务器资源少，只能限定线程数来执行任务。

当核心线程数未达到设定值时创建线程。当核心线程达到设定值时，则将任务加入阻塞队列，该阻塞队列为链表阻塞队列，为无界队列，可以一直存储下去。如果有线程空闲，则不必等待，直接销毁。

使用无界队列的影响：当任务很多且处理不及时，可能会有很多任务阻塞在队列中，一直影响电脑的运行，甚至导致崩溃。

**SingleThreadPool**:该线程池只有一条线程，当有任务来时会先存在阻塞队列中，使用一条线程来处理；只有当线程因为异常退出后才会再次创建一条线程来接着执行任务。

**CachedThreadPool**:这是一个无界的线程池，该线程池的大小无限制，并且核心线程数为0，线程空闲时间为60秒，当有任务来时 ，会看是否有空余线程，有则直接执行；没有则创建一个线程去执行。该线程池适合处理那些任务频繁但是连接时间短的场景。

## 异步结果

实现了Future接口或FutureTask的类，代表异步 结果。

FurureTask实现了Future接口外，还实现了Executor接口，可以在线程执行中被直接执行。FutureTask对象有三种状态：未启动，启动中，执行结束。其中未启动为初始化了对象，但还未执行run()方法时；二启动中则为正在执行run()方法；最后执行结束为将run()方法执行结束后。可以对返回的FutureTask对象进行get()操作得出执行结果，但是当处于未启动时使用该方法则会导致该任务不会再被执行；在执行中调用此方法则对导致该线程阻塞，一直到该任务处理完成后会退出阻塞；但在执行结束后调用次方法则会立刻返回处理结果。

FutureTask内部类Sync实现了AQS，主要实现了获取尝试阻塞当前线程和尝试释放当前线程连个方法。

当调用run()方法时，首先会执行任务中的内容，执行后会使用源自操作来更新状态，状态根性完后就调用释放方法来释放线程，组后唤醒下一个线程。

当调用get()时会检查状态，如果是完成状态，直接返回结果就行；如果是未结束，则会调用阻塞方法，将当前线程阻塞进入等待队列中。



























