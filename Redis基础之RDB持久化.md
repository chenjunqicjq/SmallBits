# Redis基础之RDB持久化

## RDB文件的创建和载入

### 创建

Redis是一个基于内存的数据库服务器，数据操作也是在内存中，当服务器进程停止后或者计算机关闭后，里面的数据将会被清除。但数据库本来就是保存数据的地方，所以Redis提供了RDB持久化方式。使用生成RDB文件的方式将当前数据据的状态保存起来，然后保存到磁盘中。

当执行SAVE或者BGSAVE命令时，会创建一个RDB文件，保存当前数据库的状态。但是SAVE和BGSAVE有一些区别：

**SAVE**：当执行SAVE命令时，服务器会阻塞，只有当RDB文件写入结束后才能继续处理请求命令。

**BGSAVE**：当执行BGSAVE命令操作时，会创建一个子进程来执行创建RDB文件并写入数据的操作，而父进程依然处理请求命令。

当在执行BGSAVE操作时，会对SAVE命令拒接，不能使父子进程都进行RDB文件写入操作；

当在执行BGSAVE操作时，会对另一个BGSAVE操作进行拒接，两个BGSAVE会产生竞争。

### 载入

Redis在载入RDB文件时会阻塞，无法处理请求命令，只有当执行完后才会恢复。

## 自动间隔性保存文件

Redis中可以设置一定的条件，使满足条件时候自动保存RDB文件。Redis持有一个条件数组，其中保存了触发条件。可以通过设定来修改规则。比如一分钟内执行10次修改操作，同时会有一个数组保存了从上次生成RDB文件到现在执行的修改操作次数。系统每隔500毫秒就进行一次检查操作，当发现符合条件时近新建一个RDB文件，同时重置操作数为零。



























