# 多线程之线程池

## 为什么需要使用线程池

当任务请求多导致单条线程处理很慢导致请求任务阻塞，而使用多条线程可以提高效率，但是线程的创建和销毁都需要切回核心态去调度，从而浪费很多资源，很可能最后还没有单线程处理速度快。所以引入线程池，将在池中创建一定数量的线程，需要时直接可以使用和处理任务，不必频繁的创建销毁。

## 线程池的几个参数

**核心线程数**：核心线程数就是线程池里主要处理任务的线程数量。

**最大线程数**：最大线程数为线程池中允许的线程数最大数量。

**保持时间**：当线程池里的线程在空闲时等待的最大时间，超过这个时间则自动销毁。

**时间单位**：保持时间的时间单位，可以为天，小时，分，秒，毫秒，纳秒等。

**阻塞队列类型**：当核心线程都在执行任务时会将新的任务保存在等待队列中。等待队列分为三种：

   1.数组阻塞队列：基于数组实现的一个有界队列，最大值为Integer的最大值，具有先进先出的特性。

​    2.链表阻塞队列：基于链表实现的阻塞队列，也具有先进先出的特性，并且吞吐量比数组的要高。

​    3.缓存队列：该队列只保存一个任务，只有当当前任务处理后才能接受其他任务。  

​    4.优先级队列：这是一个具有优先级的队列，并且无界，可以一直存储任务进去。

**饱和策略**：当创建的线程数量等于最大线程数时，还有任务进来则会启动饱和策略进行处理。一般有几种策略：

​    1.直接触发异常。

​     2.丢掉列表里最近的任务，并且处理当前任务。

​     3.不处理，直接丢弃。

## 线程池执行过程

判断核心线程是否都在执行，若有空闲，则直接调用空闲线程执行该任务；若无，则判断当前核心线程数是否达到了核心线程数，若没有 ，则创建一个核心线程来执行该任务；若到达，则进入下一步。

判断阻塞队列是否已满，若有空闲则将其加入阻塞队列中；若无空闲队列，则进入下一步。

判断当前线程池中的线程数是否达到了最大线程数，若没有，则创建一条工作线程，然后执行任务；若到达，则执行下一步。

此时则应该启动饱和策略，根据不同的策略有不同的效果。

## 线程池的配置

若果是I/O密集型的任务，因为在I/O操作时需要花费很多时间，而线程需要一直等待，则浪费了cpu的资源，可以设置线程数多一些。

若果是cpu密集型的任务，则需要频繁的执行任务，则线程数少设置一点，等于cpu数或者略微大一点即可。

有些任务的请求有长有短，则可以设置优先队列，让处理时间少的先进行处理。