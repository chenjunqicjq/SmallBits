# Redis基础之数据库基础认识

## 数据库结构

Redis持有一个数据库类型的数组，数组中每一个元素就是一个数据库，通过移动指针来改变当前操作的数据库。并且持有一个属性显示当前数据库的数量。

每个数据库由两个字典构成，一个键值对字典，一个过期字典。

键值对字典中的键都是一个字符串对象，存放在键空间。而值对象则可以是字符串对象，哈希对象，有序集合对象，集合对象，列表对象等。

##过期间删除策略

而过期字典则记录了设置了过期时间的键和对应的过期时间。

Redis中的键过期删除策略主要用两种：

**惰性删除策略**：就是当一个键过期时，Redis并不会主动的删除该键，而是在等数据库访问到该键时检查是否过期，过期则删除，返回空，未过期则返回查看结果。

  *优点*：对cpu很友好，每次只删除一个过期键，不会占用太多时间导致停止服务.

  *缺点*：但对内存不是很友好，本来Redis就是一个对内存紧张的数据库，当有些键过期，但是长时间并没有被访问，则会一直保存，占用内存空间，甚至有些键就不会被再访问，造成内存泄漏。

**定期删除策略**：采用的是定期删除，一段时间后会对数据库进行过期间检查并删除。每次检查会设定检查时间，当在检查时间内没有将数据库都过一遍则会记录当前的数据库，下次检查从当前地方接着遍历检查。

## AOF,RBD，复制对过期间的处理

**AOF传入**：当生成AOF文件时，不管该键是否过期，都会被写入到AOF文件中，只有在查询该键的时候才会在数据库中删除该键并且给AOF文件一个DEL命令，从而删除该键。

**AOF重写**：在执行AOF文件重写时，会对过期的键进行过滤，不会载入数据库中。

**RBD生成**：当执行生成RBD文件时，会对过期的键进行过滤，文件中不会保存过期的键。

**RBD载入**：当运行的是主服务器模式时，会对加载入的文件中的键进行检查，当发现过期键则不进行载入。当运行的是从服务器模式时，不会做检查，直接载入文件。不过当主服务器进行数据同步时发现该键过期，则在从服务器中删除该键。

**复制**：当主服务器发现一个键过期，删除该键并发送DEL命令给从服务器进行删除保持数据一致性。当从服务器发现一个键过期，并不会进行删除，任然存储，只有当主服务器发送命令时才进行删除。





























